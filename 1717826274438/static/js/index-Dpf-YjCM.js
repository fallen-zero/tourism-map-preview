var V=Object.defineProperty;var Y=(t,e,a)=>e in t?V(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var N=(t,e,a)=>(Y(t,typeof e!="symbol"?e+"":e,a),a);import{M as G,O as H,P,Q as z,a as B,r as g,R as A,U,V as W,u as _,o as b,D as M,G as J,W as $,X as Q,f as C,e as k,T,c as S,v as D,Y as I,H as X,Z}from"./node/pnpm-BADwu50r.js";import{_ as j}from"./index-WVPjXjam.js";const F={KEY:"67608d5cddbb31f46fc0d758745e6415",SERVER_KEY:"c40845db30fe3c43fe63e9cafd8dec45",JS_CODE:"1dfc90c406278777a8387b407b17bfdb"};var O=(t=>(t.NORMAL="amap://styles/normal",t.DARK="amap://styles/dark",t.LIGHT="amap://styles/light",t.WHITESMOKE="amap://styles/whitesmoke",t.FRESH="amap://styles/fresh",t.GREY="amap://styles/grey",t.GRAFFITI="amap://styles/graffiti",t.MACARON="amap://styles/macaron",t.BLUE="amap://styles/blue",t.DARKBLUE="amap://styles/darkblue",t.WINE="amap://styles/wine",t))(O||{});class q{constructor(){N(this,"loading",null)}show(e){this.close();let a={};e&&(typeof e=="string"?a.text=e:a=e),this.loading=z.service({lock:!0,fullscreen:!0,background:"rgba(0, 0, 0, 0.7)",target:"#app-box",customClass:"pointer-events-auto",...a})}setText(e){this.loading&&this.loading.setText(e)}close(){this.loading&&this.loading.close(),this.loading=null}}const ee=new q,x={ElMessage:G,ElMessageBox:H,ElNotification:P,ElLoading:ee},te={"element-loading-text":"地图加载中...",class:"wh-full overflow-hidden"},ae=B({__name:"index",props:{viewMode:{default:"3D"},center:{default:()=>[120.30811,30.060291]},zoom:{default:11},pitch:{default:0},mapStyle:{default:O.GREY},plugins:{default:()=>[]},showLabel:{type:Boolean,default:!0},terrain:{type:Boolean,default:!1}},emits:["mapCallback"],setup(t,{expose:e,emit:a}){const l=t,i=a;let s=null,o=null;const u=g(null),h=g("opacity-0"),p=g(!1);async function w(){if(u.value){s==null||s.destroy(),h.value="opacity-0",p.value=!0;try{window._AMapSecurityConfig={securityJsCode:F.JS_CODE};const{center:n,viewMode:f,zoom:r,pitch:d,mapStyle:v,plugins:m,showLabel:y,terrain:E}=l;if(o=await $.load({key:F.KEY,version:"2.0",plugins:m,Loca:{version:"2.0"}}),!o)return;s=new o.Map(u.value,{viewMode:f,center:n,zoom:r,pitch:d,showLabel:y,mapStyle:v,layers:E?[new o.TileLayer.Satellite]:[]}),s.on("complete",()=>{h.value="opacity-100",p.value=!1,!(!s||!o)&&i("mapCallback",s,o)})}catch(n){p.value=!1,x.ElMessage.error("地图加载失败"),console.error(n)}}}A(()=>{w()}),U(()=>{s==null||s.destroy()});function L(){return s}function c(){return o}function R(n){s&&o&&n(s,o)}return e({useMap:R,getMap:L,getMapLoader:c}),(n,f)=>{const r=Q;return W((b(),M("div",te,[J("div",{ref_key:"mapRef",ref:u,class:"a-map"},null,512)])),[[r,_(p)]])}}}),ne=j(ae,[["__scopeId","data-v-979dc56a"]]),se={class:"relative size-full"},oe={key:0,class:"absolute bottom-20px right-20px"},le=B({name:"home"}),de=B({...le,setup(t){let e=null,a=null,l=null,i=null;const s=[120.264366,30.186776],o=g(!1),u=g(!1);async function h(n,f){e=n,a=f,o.value=!0,x.ElNotification.success({message:"请选择旅游范围",duration:5e3})}function p(n){!e||!a||(l=new a.Circle({center:n,radius:6e3,strokeColor:"#FF33FF",strokeWeight:6,strokeOpacity:.2,fillOpacity:.4,strokeStyle:"dashed",strokeDasharray:[10,10],fillColor:"#1791fc"}),e.add(l),i=new a.CircleEditor(e,l),i.open(),u.value=!0)}function w(){e&&(i==null||i.close(),i=null,l&&e.remove(l),l==null||l.destroy(),l=null,u.value=!1)}function L(){if(e){if(u.value){w();return}x.ElMessage.success("点击地图选取中心点, 拖拽绘制圆形范围"),e.on("click",n=>{p(n.lnglat)},void 0,!0)}}let c=null;function R(){var y;if(!e||!a||!i)return;const n=i.getTarget();if(!n)return;const f=n.getCenter(),r=n.getBounds(),d=(y=r==null?void 0:r.getHeight())!=null?y:0;function v(){const E=f.getLng()+Math.random()*d-d/2,K=f.getLat()+Math.random()*d-d/2;return[E,K]}let m=v();if(r)for(;!r.contains(m);)m=v();if(c){c.setPosition(m);return}c=new a.Marker({position:m}),c.on("click",()=>{c==null||c.getPosition()}),e.add(c)}return(n,f)=>{const r=ne,d=Z;return b(),M("div",se,[C(r,{center:s,zoom:13,plugins:["AMap.CircleEditor"],"map-style":_(O).NORMAL,onMapCallback:h},null,8,["plugins","map-style"]),C(T,{appear:!0,"enter-active-class":"animate__animated animate__bounceInRight","leave-to-class":"animate__animated animate__bounceOutRight"},{default:k(()=>[_(o)?(b(),M("div",oe,[C(T,{appear:!0,"enter-active-class":"animate__animated animate__bounceInRight","leave-to-class":"animate__animated animate__bounceOutRight"},{default:k(()=>[_(u)?(b(),S(d,{key:0,type:"success",onClick:R},{default:k(()=>[D(" 随机生成点位 ")]),_:1})):I("",!0)]),_:1}),C(d,{type:"primary",onClick:L},{default:k(()=>[D(X(_(u)?"取消范围":"选择范围"),1)]),_:1})])):I("",!0)]),_:1})])}}});export{de as default};
